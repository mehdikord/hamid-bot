# ุฑุจุงุช ุชูฺฏุฑุงู ูุฏุฑุช CRM (Aiogram 3 - ูุงุฑุณ)

ุงู ุฑุจุงุช ุชูฺฏุฑุงู ุจุง ุงุณุชูุงุฏู ุงุฒ Aiogram 3.x ุจุฑุง ูุฏุฑุช ุฏุงุฎู ุชู ูุฑูุด ุณุงุฎุชู ุดุฏู ุงุณุช. ุฑุจุงุช ูุฏุฑุงู ู ูุฑูุดูุฏฺฏุงู ุฑุง ุจู ูู ูุชุตู ูโฺฉูุฏ ู ุจุฑ ุงุณุงุณ ูุนูุงุฑ ูุจุชู ุจุฑ ฺฉุงููพูููุช ุทุฑุงุญ ุดุฏู ุงุณุช.

## ูฺฺฏโูุง ุงุตู

- **ุงุฑุฌุงุน ูุดุชุฑ**: ูุฏุฑุงู ูโุชูุงููุฏ ูุดุชุฑุงู ุฌุฏุฏ ุฑุง ุจู ูุฑูุดูุฏฺฏุงู ุงุฑุฌุงุน ุฏููุฏ
- **ุซุจุช ูุนุงูุช**: ูุฑูุดูุฏฺฏุงู ูโุชูุงููุฏ ุชูุงุณโูุงุ ูพฺฏุฑโูุง ู ุณุงุฑ ูุนุงูุชโูุง ุฑุง ุซุจุช ฺฉููุฏ
- **ุงุฏุขูุฑูุง**: ุซุจุช ุงุฏุขูุฑูุง ุดุฎุต ุจุฑุง ูุฏุฑุงู ู ูุฑูุดูุฏฺฏุงู
- **ฺฏุฒุงุฑุดโฺฏุฑ**: ฺฏุฒุงุฑุดโูุง ุฑูุฒุงูู ุฎูุฏฺฉุงุฑ
- **ฺฉุดู ููุถูุนุงุช ฺฏุฑูู**: ฺฉุดู ุฎูุฏฺฉุงุฑ ููุถูุนุงุช (Topics) ุฏุฑ ฺฏุฑููโูุง ุชูฺฏุฑุงู
- **API Webhook**: ุงุฑุณุงู ุงุนูุงูโูุง ู ุฑุณุฏูุง ุงุฒ ุทุฑู API ุฎุงุฑุฌ
- **ุฑุงุจุท ฺฉุงุฑุจุฑ ูุงุฑุณ**: ุชูุงู ูุชูโูุง ู ุฏฺฉููโูุง ุจู ุฒุจุงู ูุงุฑุณ

## ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### 1. ูุงุฒููุฏโูุง
```bash
pip install -r requirements.txt
```

### 2. ูพฺฉุฑุจูุฏ

#### ุงูู) ฺฉูพ ฺฉุฑุฏู ูุงู ุชูุธูุงุช:
```bash
cp config_template.py config.py
```

#### ุจ) ุฏุฑุงูุช API credentials ุงุฒ Telegram
ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ูุงุจูุช ฺฉุดู ููุถูุนุงุชุ ูุงุฒ ุจู API credentials ุฏุงุฑุฏ:

1. ุจู [my.telegram.org](https://my.telegram.org) ุจุฑูุฏ
2. ูุงุฑุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฎูุฏ ุดูุฏ
3. ุจู ุจุฎุด "API development tools" ุจุฑูุฏ
4. ฺฉ ุงูพูฺฉุดู ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ
5. `API_ID` ู `API_HASH` ุฑุง ฺฉูพ ฺฉูุฏ

#### ุฌ) ูุฑุงุด ูุงู config.py
ูุงู `config.py` ุฑุง ุจุง ุงุทูุงุนุงุช ุฎูุฏ ูุฑุงุด ฺฉูุฏ:

```python
# ุชูฺฉู ุฑุจุงุช ุงุฒ BotFather
BOT_TOKEN = "YOUR_BOT_TOKEN"

# API credentials ุจุฑุง ฺฉุดู ููุถูุนุงุช (ุงุฒ my.telegram.org)
API_ID = 12345678  # API ID ุงุฒ my.telegram.org
API_HASH = "your_api_hash_here"  # API Hash ุงุฒ my.telegram.org

# ุดูุงุณูโูุง ุชูฺฏุฑุงู ูุฏุฑุงู ู ูุฑูุดูุฏฺฏุงู
MANAGER_IDS = [123456789]  # ุดูุงุณู ุชูฺฏุฑุงู ูุฏุฑุงู
SELLER_IDS = [987654321]   # ุดูุงุณู ุชูฺฏุฑุงู ูุฑูุดูุฏฺฏุงู

# ูุงูโูุง ููุงุด (ุงุฎุชุงุฑ)
USER_NAMES = {
    123456789: "ุนู ูุฏุฑ",
    987654321: "ุฑุถุง ูุฑูุดูุฏู"
}

# ุดูุงุณู ฺฏุฑูู ุจุฑุง ฺฏุฒุงุฑุดโูุง ุชู
GROUP_CHAT_ID = -1001234567890
```

#### ุฏ) ูุญูู ุฏุฑุงูุช ุดูุงุณูโูุง ุชูฺฏุฑุงู
- **ุดูุงุณู ฺฉุงุฑุจุฑ**: ุจู @userinfobot ูพุงู ุฏูุฏ
- **ุดูุงุณู ฺฏุฑูู**: @userinfobot ุฑุง ุจู ฺฏุฑูู ุงุถุงูู ฺฉูุฏ ู /start ุจุฒูุฏ

### 3. ุฑุงูโุงูุฏุงุฒ ุงุญุฑุงุฒ ููุช ฺฉุงุฑุจุฑ (ุจุฑุง ฺฉุดู ููุถูุนุงุช)

ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ูุงุจูุช ฺฉุดู ููุถูุนุงุช ฺฏุฑููุ ุงุจุชุฏุง ุจุงุฏ ุจุง ุญุณุงุจ ฺฉุงุฑุจุฑ ุดุฎุต ุฎูุฏ ุงุญุฑุงุฒ ููุช ฺฉูุฏ:

```bash
python setup_user_auth.py
```

**ูฺฉุงุช ููู:**
- ุงุฒ ุญุณุงุจ ฺฉุงุฑุจุฑ **ุดุฎุต** ุฎูุฏ ุงุณุชูุงุฏู ฺฉูุฏ (ูู ุญุณุงุจ ุฑุจุงุช)
- ุดูุงุฑู ุชููู ู ฺฉุฏ ุชุฃุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
- ุงู ูุฑุขูุฏ ููุท ฺฉ ุจุงุฑ ุงูุฌุงู ูโุดูุฏ
- ูุงู `topic_discovery_session.session` ุงุฌุงุฏ ูโุดูุฏ

### 4. ุงุฌุฑุง ุฑุจุงุช

#### ุงุฌุฑุง ุนุงุฏ (ุจุฑุง ุชุณุช):
```bash
python main.py
```

#### ุงุฌุฑุง ุจู ุนููุงู ุณุฑูุณ (ุจุฑุง ูุญุท ุชููุฏ):
```bash
# ุงุฌุฑุง ุฏุฑ ูพุณโุฒููู ุจุง nohup
nohup /root/hamid-bot-main/venv/bin/python main.py > bot.log 2>&1 &

# ุจุฑุฑุณ ูุถุนุช ุณุฑูุณ
ps aux | grep main.py
```

#### ูุฏุฑุช ุณุฑูุณ:
```bash
# ูุชููู ฺฉุฑุฏู ุณุฑูุณ
pkill -f "python main.py"

# ุง ุจุง PID ูุดุฎุต
kill <PID>

# ุจุฑุฑุณ ูุงฺฏโูุง
tail -f bot.log
```

#### ุงุฌุฑุง ุจุง systemd (ูพุดููุงุฏ ุจุฑุง ุณุฑูุฑ):
```bash
# ฺฉูพ ฺฉุฑุฏู ูุงู ุณุฑูุณ
sudo cp hamid-bot.service /etc/systemd/system/

# ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ systemd
sudo systemctl daemon-reload

# ูุนุงูโุณุงุฒ ุณุฑูุณ
sudo systemctl enable hamid-bot

# ุดุฑูุน ุณุฑูุณ
sudo systemctl start hamid-bot

# ุจุฑุฑุณ ูุถุนุช
sudo systemctl status hamid-bot

# ูุดุงูุฏู ูุงฺฏโูุง
sudo journalctl -u hamid-bot -f

# ูุชููู ฺฉุฑุฏู ุณุฑูุณ
sudo systemctl stop hamid-bot

# ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ุณุฑูุณ
sudo systemctl restart hamid-bot
```

## ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ูุฏุฑุงู:
1. **๐ ุงุฑุฌุงุน ูุดุชุฑ**: ูุดุชุฑ ุฌุฏุฏ ุจู ูุฑูุดูุฏู ุงุฑุฌุงุน ุฏูุฏ
2. **๐ฐ ุซุจุช ูพุฑุฏุงุฎุช**: ูพุฑุฏุงุฎุช ุฏุฑุงูุช ุฑุง ุซุจุช ฺฉูุฏ
3. **๐ ุซุจุช ุงุฏุขูุฑ**: ุงุฏุขูุฑ ุดุฎุต ุชูุธู ฺฉูุฏ
4. **๐ ฺฏุฒุงุฑุดโูุง**: ฺฏุฒุงุฑุด ุฑูุฒุงูู ุชู ุฑุง ูุดุงูุฏู ฺฉูุฏ

### ุจุฑุง ูุฑูุดูุฏฺฏุงู:
1. **ุฏุฑุงูุช ุงุฑุฌุงุน**: ูพุงูโูุง ุงุฑุฌุงุน ูุดุชุฑ ุงุฒ ูุฏุฑ ุฏุฑุงูุช ฺฉูุฏ
2. **ุซุจุช ูุนุงูุช**: 
   - ๐ ุซุจุช ุชูุงุณ
   - ๐ ุซุจุช ูพฺฏุฑ  
   - โ ุชุบุฑ ูุถุนุช
   - ๐ ุงูุฒูุฏู ุงุฏุฏุงุดุช
3. **๐ ุซุจุช ุงุฏุขูุฑ**: ุงุฏุขูุฑ ุดุฎุต ุชูุธู ฺฉูุฏ

## ฺฉุดู ููุถูุนุงุช ฺฏุฑูู

ุฑุจุงุช ูุงุจูุช ฺฉุดู ุฎูุฏฺฉุงุฑ ููุถูุนุงุช (Topics) ุฏุฑ ฺฏุฑููโูุง ุชูฺฏุฑุงู ุฑุง ุฏุงุฑุฏ:

### ูฺฺฏโูุง ฺฉุดู ููุถูุนุงุช:
- **ฺฉุดู ุฎูุฏฺฉุงุฑ**: ุชุดุฎุต ููุถูุนุงุช ูุนุงู ุฏุฑ ฺฏุฑูู
- **ูุงูโูุง ูุงูุน**: ุฏุฑุงูุช ูุงูโูุง ูุงูุน ููุถูุนุงุช (ูู ููุท ID)
- **ุชุดุฎุต ููุน ฺฏุฑูู**: ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุงูฺฉู ฺฏุฑูู ุงุฒ ููุถูุนุงุช ูพุดุชุจุงู ูโฺฉูุฏ ุง ูู
- **ูพุดุชุจุงู ุงุฒ ุงููุงุน ฺฏุฑูู**: ฺฏุฑููโูุง ูุนูููุ ุณููพุฑฺฏุฑููโูุง ู ฺฉุงูุงูโูุง

### ูุญูู ฺฉุงุฑ:
1. ุฑุจุงุช ุจุง ุงุณุชูุงุฏู ุงุฒ `setup_user_auth.py` ุจุง ุญุณุงุจ ฺฉุงุฑุจุฑ ุดุฎุต ุงุญุฑุงุฒ ููุช ูโฺฉูุฏ
2. ููฺฏุงู ุฏุฑุฎูุงุณุช ฺฉุดู ููุถูุนุงุชุ ุฑุจุงุช ุจู ฺฏุฑูู ุฏุณุชุฑุณ ูพุฏุง ูโฺฉูุฏ
3. ููุถูุนุงุช ูุนุงู ุฑุง ุดูุงุณุง ู ูุงูโูุง ูุงูุน ุขูโูุง ุฑุง ุงุณุชุฎุฑุงุฌ ูโฺฉูุฏ
4. ูุชุฌู ุดุงูู ID ููุถูุนุ ูุงู ูุงูุน ู ูุถุนุช ุขู ุงุณุช

### ูุซุงู ุฎุฑูุฌ:
```json
{
  "topics": [
    {
      "topic_id": 1,
      "name": "ุนููู",
      "status": "active"
    },
    {
      "topic_id": 12345,
      "name": "ูุฑูุด",
      "status": "active"
    },
    {
      "topic_id": 12346,
      "name": "ูพุดุชุจุงู",
      "status": "active"
    }
  ]
}
```

## API Webhook

ุฑุจุงุช ุฏุงุฑุง ฺฉ API Webhook ุจุฑุง ุงุฑุณุงู ุงุนูุงูโูุง ู ุฑุณุฏูุง ุงุณุช:

### ุขุฏุฑุณ API
```
http://localhost:8000
```

### ุงุฑุณุงู ุงุนูุงู ุณุงุฏู
```bash
curl -X POST "http://localhost:8000/send-notification" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": 123456789,
    "message": "ุณูุงู! ุงู ฺฉ ุงุนูุงู ุชุณุช ุงุณุช.",
    "parse_mode": "HTML"
  }'
```

### ุงุฑุณุงู ุงุนูุงู ุจุง ุฏฺฉูู
```bash
curl -X POST "http://localhost:8000/send-notification-with-buttons" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": 123456789,
    "message": "ูุทูุงู ุนููุงุช ููุฑุฏ ูุธุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ:",
    "buttons": [
      [{"text": "ุชุฃุฏ", "callback_data": "confirm"}],
      [{"text": "ูุบู", "callback_data": "cancel"}]
    ]
  }'
```

### ฺฉุดู ููุถูุนุงุช ฺฏุฑูู
```bash
curl -X POST "http://localhost:8000/discover-group-topics" \
  -H "Content-Type: application/json" \
  -d '{
    "group_id": -1001234567890
  }'
```

## ุณุงุฎุชุงุฑ ูพุฑูฺู

```
project_root/
โโโ main.py                    # ููุทู ูุฑูุฏ ุฑุจุงุช ู API
โโโ config.py                  # ุชูุธูุงุช ุฑุจุงุช
โโโ config_template.py         # ุงูฺฏู ุชูุธูุงุช
โโโ setup_user_auth.py         # ุฑุงูโุงูุฏุงุฒ ุงุญุฑุงุฒ ููุช ฺฉุงุฑุจุฑ
โโโ requirements.txt           # ูุงุจุณุชฺฏโูุง
โโโ handlers/                  # ฺฉูุชุฑูโฺฉููุฏูโูุง ุฑุจุงุช
โ   โโโ common.py             # ุฏุณุชูุฑุงุช ุนููู
โ   โโโ auth.py               # ุงุญุฑุงุฒ ููุช
โ   โโโ seller_main.py        # ุฏุงุดุจูุฑุฏ ูุฑูุดูุฏู
โ   โโโ reports.py            # ฺฏุฒุงุฑุดโฺฏุฑ
โโโ keyboards/                # ุตูุญูโฺฉูุฏูุง ุฏุงุฎู
โ   โโโ main_menu.py          # ููู ุงุตู
โ   โโโ navigation.py         # ูุงูุจุฑ
โโโ middleware/               # ูุงูโุงูุฒุงุฑูุง
โ   โโโ auth_middleware.py    # ูุงูโุงูุฒุงุฑ ุงุญุฑุงุฒ ููุช
โโโ utils/                    # ุงุจุฒุงุฑูุง ฺฉูฺฉ
โ   โโโ telegram_helpers.py   # ฺฉูฺฉโฺฉููุฏูโูุง ุชูฺฏุฑุงู
โโโ topic_discovery_session.session  # ูุงู ุฌูุณู ฺฉุงุฑุจุฑ
โโโ hamid-bot.service         # ูุงู ุณุฑูุณ systemd
```

## ูฺฉุงุช ูู

- **Aiogram 3.x**: ุงุณุชูุงุฏู ุงุฒ ุขุฎุฑู ูุณุฎู Aiogram
- **FastAPI**: API Webhook ุจุง FastAPI ู Uvicorn
- **Telethon**: ฺฉุดู ููุถูุนุงุช ฺฏุฑูู ุจุง Telethon
- **ุงุญุฑุงุฒ ููุช ฺฉุงุฑุจุฑ**: ุงุณุชูุงุฏู ุงุฒ ุญุณุงุจ ฺฉุงุฑุจุฑ ุดุฎุต ุจุฑุง ุฏุณุชุฑุณ ฺฉุงูู ุจู API
- **ฺฉุดู ููุดููุฏ ููุถูุนุงุช**: ุชุดุฎุต ุฎูุฏฺฉุงุฑ ููุถูุนุงุช ูุนุงู ุฏุฑ ฺฏุฑููโูุง
- **API ุฎุงุฑุฌ**: ูุฏุฑุช ุฏุงุฏูโูุง ุงุฒ ุทุฑู API ุฎุงุฑุฌ
- **ุฑุงุจุท ฺฉุงุฑุจุฑ ูุงุฑุณ**: ุชูุงู ูุชูโูุง ู ุฏฺฉููโูุง ุจู ุฒุจุงู ูุงุฑุณ
- **ูุนูุงุฑ ุขุณูฺฉุฑูู**: ุนููฺฉุฑุฏ ุจูุชุฑ ุจุง async/await
- **ููุทูู ุฒูุงู**: ุขุณุง/ุชูุฑุงู

## ุนุจโุงุจ

### ูุดฺฉู ฺฉุดู ููุถูุนุงุช
ุงฺฏุฑ ฺฉุดู ููุถูุนุงุช ฺฉุงุฑ ููโฺฉูุฏ:

1. **ุจุฑุฑุณ ุงุญุฑุงุฒ ููุช ฺฉุงุฑุจุฑ**:
   ```bash
   python setup_user_auth.py
   ```

2. **ุจุฑุฑุณ API credentials**:
   - ูุทูุฆู ุดูุฏ `API_ID` ู `API_HASH` ุฏุฑ `config.py` ุตุญุญ ูุณุชูุฏ
   - ุงุฒ [my.telegram.org](https://my.telegram.org) credentials ุฌุฏุฏ ุฏุฑุงูุช ฺฉูุฏ

3. **ุจุฑุฑุณ ุฏุณุชุฑุณ ุจู ฺฏุฑูู**:
   - ูุทูุฆู ุดูุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุดุฎุต ุดูุง ุนุถู ฺฏุฑูู ุงุณุช
   - ูุทูุฆู ุดูุฏ ฺฏุฑูู ุงุฒ ููุถูุนุงุช ูพุดุชุจุงู ูโฺฉูุฏ

4. **ุญุฐู ูุงู ุฌูุณู**:
   ```bash
   rm topic_discovery_session.session
   python setup_user_auth.py
   ```

### ูุดฺฉู API Webhook
ุงฺฏุฑ API ฺฉุงุฑ ููโฺฉูุฏ:

1. **ุจุฑุฑุณ ูพูุฑุช**:
   - ูุทูุฆู ุดูุฏ ูพูุฑุช 8000 ุขุฒุงุฏ ุงุณุช
   - ูพูุฑุช ุฑุง ุฏุฑ `main.py` ุชุบุฑ ุฏูุฏ

2. **ุจุฑุฑุณ ูุงฺฏโูุง**:
   ```bash
   tail -f bot.log
   ```

## ูฺฉุงุช ุงููุช

- **ูุงูโูุง ุญุณุงุณ**: `config.py` ู `topic_discovery_session.session` ุฏุฑ `.gitignore` ูุฑุงุฑ ุฏุงุฑูุฏ
- **ุฏุณุชุฑุณ ูุญุฏูุฏ**: ููุท ฺฉุงุฑุจุฑุงู ูุฌุงุฒ (ุฏุฑ ูุณุชโูุง MANAGER_IDS ู SELLER_IDS) ูโุชูุงููุฏ ุงุฒ ุฑุจุงุช ุงุณุชูุงุฏู ฺฉููุฏ
- **API credentials**: API_ID ู API_HASH ุฑุง ูุญุฑูุงูู ูฺฏู ุฏุงุฑุฏ
- **ูุงู ุฌูุณู**: ูุงู `topic_discovery_session.session` ุฑุง ูุญุฑูุงูู ูฺฏู ุฏุงุฑุฏ
- **ุชูฺฉู ุฑุจุงุช**: ุชูฺฉู ุฑุจุงุช ู ุดูุงุณูโูุง ฺฉุงุฑุจุฑุงู ุฑุง ูุญุฑูุงูู ูฺฏู ุฏุงุฑุฏ
- **ูุญุท ุชููุฏ**: ุจุฑุง ูุญุท ุชููุฏุ ุงุฒ webhook ุจู ุฌุง polling ุงุณุชูุงุฏู ฺฉูุฏ

## ูุงูโูุง ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู (.gitignore)

```
config.py
topic_discovery_session.session
*.log
.env
__pycache__/
*.pyc
venv/
```

## ูพุดุชุจุงู

ุจุฑุง ฺฏุฒุงุฑุด ูุดฺฉูุงุช ุง ุฏุฑุฎูุงุณุช ูฺฺฏโูุง ุฌุฏุฏุ ูุทูุงู issue ุงุฌุงุฏ ฺฉูุฏ.

## ูุฌูุฒ

ุงู ูพุฑูฺู ุชุญุช ูุฌูุฒ MIT ููุชุดุฑ ุดุฏู ุงุณุช.
